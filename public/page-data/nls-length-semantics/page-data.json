{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/nls-length-semantics/","result":{"data":{"allFile":{"edges":[]},"mdx":null,"mdPrevious":null,"mdNext":null,"wpPost":{"id":"cG9zdDo3MTI=","title":"テーブル生成時には列長セマンティクスを明示すべき","content":"\n<h2 class=\"wp-block-heading\">問題点</h2>\n\n\n\n<p>これはテーブル生成時の問題で、Oracle データベースのパラメータである列長セマンティクス(NLS_LENGTH_SEMANTICS)を正しく設定しておかないと、意図した文字数のデータを挿入することができなくなる可能性があります。<br> 特に、1文字≠1バイトである日本語のようなマルチバイト文字を使う環境では無視できないことと思います。 <br>最大桁数に近い値を入れないと気が付かないようなやや珍しめな問題ですが、発生時に原因特定がしにくかったり、 環境によっては再現しないなどの環境依存なところもあり、顕在化するとやっかいな問題です。</p>\n\n\n\n<h2 class=\"wp-block-heading\">対象DB</h2>\n\n\n\n<ul><li>Oracle 9i以降</li></ul>\n\n\n\n<h2 class=\"wp-block-heading\">仕様</h2>\n\n\n\n<h3 class=\"wp-block-heading\">Oracle データベース仕様</h3>\n\n\n\n<ul><li>列長セマンティクスには、BYTEかCHARを指定できます。BYTEがバイト数で長さを判定し、CHARでは文字数で長さを判定します。</li></ul>\n\n\n\n<p>調査方法：以下のSQLで取得できます。</p>\n\n\n\n<script src=\"https://gist.github.com/nisioka/710ff98c13f62049520d8c660d5f3914.js\"></script>\n\n\n\n<ul><li>テーブル生成時のDDLで列長セマンティクスを指定するのは以下の箇所です。3,4,5行目の型の後の括弧のなかで長さの定義と列長セマンティクスの定義をします。ここを省略した場合にNLS_LENGTH_SEMANTICSの値が関係します。</li></ul>\n\n\n\n<script src=\"https://gist.github.com/nisioka/ff1d4dcc029055d6cf41aec166814465.js\"></script>\n\n\n\n<ul><li>テーブル生成時に列長セマンティクスが未指定の場合、デフォルト値としてNLS_LENGTH_SEMANTICSに設定されている値が使用されます。(<a rel=\"noreferrer noopener\" href=\"https://docs.oracle.com/cd/E18283_01/server.112/e10706/repunicode.htm)\" target=\"_blank\">https://docs.oracle.com/cd/E18283_01/server.112/e10706/repunicode.htm</a>)</li><li>Oracleデータベースの新規構築時には、NLS_LENGTH_SEMANTICSがBYTEで定義されていました。</li></ul>\n\n\n\n<h3 class=\"wp-block-heading\">(参考)SQL Developer仕様</h3>\n\n\n\n<p>SQL実行環境は色々とありますが、一例としてSQL Developerの仕様を記載します。</p>\n\n\n\n<ul><li>SQL Developerでは、以下の設定により列長セマンティクスにデフォルト値を埋めこみます。</li></ul>\n\n\n\n<figure class=\"wp-block-image\"><div data-gatsby-image-wrapper=\"\" style=\"position:relative;overflow:hidden;display:inline-block;vertical-align:top\" class=\"gatsby-image-wrapper gatsby-image-wrapper-constrained wp-image-809 inline-gatsby-image-wrapper\"><div style=\"max-width:966px;display:block\"><img alt=\"\" role=\"presentation\" aria-hidden=\"true\" src=\"data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#x27;500&#x27;%20width=&#x27;966&#x27;%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20version=&#x27;1.1&#x27;%3E%3C/svg%3E\" style=\"max-width:100%;display:block;position:static\"/></div><div aria-hidden=\"true\" data-placeholder-image=\"\" style=\"height:100%;left:0;position:absolute;top:0;width:100%\"></div><img data-gatsby-image-ssr=\"\" data-wp-inline-image=\"1\" data-main-image=\"\" style=\"height:100%;left:0;position:absolute;top:0;transform:translateZ(0);transition:opacity 250ms linear;width:100%;will-change:opacity;opacity:0\" sizes=\"(min-width: 966px) 966px, 100vw\" decoding=\"async\" loading=\"lazy\" data-src=\"/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/c430a50b4dae90e1c4f6ba562aaa2dd5/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&amp;a=w%3D242%26h%3D125%26fm%3Dpng%26q%3D90&amp;cd=2019-01-24T03%3A55%3A16\" data-srcset=\"/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/c430a50b4dae90e1c4f6ba562aaa2dd5/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&amp;a=w%3D242%26h%3D125%26fm%3Dpng%26q%3D90&amp;cd=2019-01-24T03%3A55%3A16 242w,/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/d031a987c8ca86afd504b03a03e1ea4d/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&amp;a=w%3D483%26h%3D250%26fm%3Dpng%26q%3D90&amp;cd=2019-01-24T03%3A55%3A16 483w,/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/162503488a996264926d86de2ae8f338/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&amp;a=w%3D966%26h%3D500%26fm%3Dpng%26q%3D90&amp;cd=2019-01-24T03%3A55%3A16 966w\" alt=\"\"/><noscript><img data-gatsby-image-ssr=\"\" data-wp-inline-image=\"1\" data-main-image=\"\" style=\"height:100%;left:0;position:absolute;top:0;transform:translateZ(0);transition:opacity 250ms linear;width:100%;will-change:opacity;opacity:0\" sizes=\"(min-width: 966px) 966px, 100vw\" decoding=\"async\" loading=\"lazy\" src=\"/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/c430a50b4dae90e1c4f6ba562aaa2dd5/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&amp;a=w%3D242%26h%3D125%26fm%3Dpng%26q%3D90&amp;cd=2019-01-24T03%3A55%3A16\" srcSet=\"/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/c430a50b4dae90e1c4f6ba562aaa2dd5/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&amp;a=w%3D242%26h%3D125%26fm%3Dpng%26q%3D90&amp;cd=2019-01-24T03%3A55%3A16 242w,/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/d031a987c8ca86afd504b03a03e1ea4d/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&amp;a=w%3D483%26h%3D250%26fm%3Dpng%26q%3D90&amp;cd=2019-01-24T03%3A55%3A16 483w,/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/162503488a996264926d86de2ae8f338/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&amp;a=w%3D966%26h%3D500%26fm%3Dpng%26q%3D90&amp;cd=2019-01-24T03%3A55%3A16 966w\" alt=\"\"/></noscript><script type=\"module\">const t=\"undefined\"!=typeof HTMLImageElement&&\"loading\"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll(\"img[data-main-image]\");for(let e of t){e.dataset.src&&(e.setAttribute(\"src\",e.dataset.src),e.removeAttribute(\"data-src\")),e.dataset.srcset&&(e.setAttribute(\"srcset\",e.dataset.srcset),e.removeAttribute(\"data-srcset\"));const t=e.parentNode.querySelectorAll(\"source[data-srcset]\");for(let e of t)e.setAttribute(\"srcset\",e.dataset.srcset),e.removeAttribute(\"data-srcset\");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector(\"[data-placeholder-image]\").style.opacity=0)}}</script></div><script type=\"application/json\" data-wp-inline-image-hydration=\"1\">{\"image\":{\"images\":{\"sources\":[],\"fallback\":{\"src\":\"/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/c430a50b4dae90e1c4f6ba562aaa2dd5/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&a=w%3D242%26h%3D125%26fm%3Dpng%26q%3D90&cd=2019-01-24T03%3A55%3A16\",\"srcSet\":\"/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/c430a50b4dae90e1c4f6ba562aaa2dd5/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&a=w%3D242%26h%3D125%26fm%3Dpng%26q%3D90&cd=2019-01-24T03%3A55%3A16 242w,/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/d031a987c8ca86afd504b03a03e1ea4d/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&a=w%3D483%26h%3D250%26fm%3Dpng%26q%3D90&cd=2019-01-24T03%3A55%3A16 483w,/_gatsby/image/e533e5c03b3411c21a9c584d2f5e4bea/162503488a996264926d86de2ae8f338/image-4.png?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2019%2F01%2Fimage-4.png&a=w%3D966%26h%3D500%26fm%3Dpng%26q%3D90&cd=2019-01-24T03%3A55%3A16 966w\",\"sizes\":\"(min-width: 966px) 966px, 100vw\"}},\"layout\":\"constrained\",\"width\":966,\"height\":500},\"alt\":\"\",\"className\":\"wp-image-809 inline-gatsby-image-wrapper\",\"data-wp-inline-image\":\"1\"}</script><figcaption>ツール&gt;プリファレンス&gt;データベース&gt;NLS</figcaption></figure>\n\n\n\n<h2 class=\"wp-block-heading\">対策</h2>\n\n\n\n<ul><li>テーブル生成時には、列長セマンティクスを省略せずに明示するのが安全策だと思います。<br>対象環境やツールに依らず、同一のDDLから列長セマンティクスも含めて同じテーブルが作成されることになるからです。何かしらDDL作成ツールを使用しているならば、列長セマンティクスを明示できるような設定にしましょう。</li><li>各環境のNLS_LENGTH_SEMANTICSを変更すること。多くのシステムの場合長さをどのように扱うかはほぼ統一できると思われますので、これをしておくと保険的対策となる認識です。</li></ul>\n\n\n\n<p>設定方法：以下の通りです。</p>\n\n\n\n<script src=\"https://gist.github.com/nisioka/2f588e2e8c2b1166c65c887c0f9063db.js\"></script>\n\n\n\n<h2 class=\"wp-block-heading\">参考</h2>\n\n\n<p><a href=\"https://docs.oracle.com/cd/E18283_01/server.112/e10706/repunicode.html\" target=\"_blank\" rel=\"noopener\">https://docs.oracle.com/cd/E18283_01/server.112/e10706/repunicode.htm</a></p>\n\n\n<p></p>\n","excerpt":"<p>問題点 これはテーブル生成時の問題で、Oracle データベースのパラメータである列長セマンティクス(NLS_LENGTH_SEMANTICS)を正しく設定しておかないと、意図した文字数のデータを挿入することができなくな [&hellip;]</p>\n","slug":"nls-length-semantics","date":"2019/01/24","featuredImage":{"node":{"altText":"","gatsbyImage":{"images":{"sources":[{"srcSet":"/_gatsby/image/f7f9c33f7c0ae16b8717415eac5cb419/8d784bc189ba5eb41b3ac0753b368c7e/oracle-e1548303868367.avif?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2018%2F06%2Foracle-e1548303868367.jpg&a=w%3D98%26h%3D78%26fm%3Davif%26q%3D75&cd=ad771aff65b5e10230ef26812c4ecf3f 98w,/_gatsby/image/f7f9c33f7c0ae16b8717415eac5cb419/05bbefeae5089236dd56550852cde74b/oracle-e1548303868367.avif?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2018%2F06%2Foracle-e1548303868367.jpg&a=w%3D195%26h%3D156%26fm%3Davif%26q%3D75&cd=ad771aff65b5e10230ef26812c4ecf3f 195w,/_gatsby/image/f7f9c33f7c0ae16b8717415eac5cb419/7e00a0774e25c85d31cc0de61d873360/oracle-e1548303868367.avif?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2018%2F06%2Foracle-e1548303868367.jpg&a=w%3D390%26h%3D312%26fm%3Davif%26q%3D75&cd=ad771aff65b5e10230ef26812c4ecf3f 390w","type":"image/avif","sizes":"(min-width: 390px) 390px, 100vw"},{"srcSet":"/_gatsby/image/f7f9c33f7c0ae16b8717415eac5cb419/e7a515045f8d46e1dcc423747b0693eb/oracle-e1548303868367.webp?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2018%2F06%2Foracle-e1548303868367.jpg&a=w%3D98%26h%3D78%26fm%3Dwebp%26q%3D75&cd=ad771aff65b5e10230ef26812c4ecf3f 98w,/_gatsby/image/f7f9c33f7c0ae16b8717415eac5cb419/866640418e94404e3278802bba923165/oracle-e1548303868367.webp?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2018%2F06%2Foracle-e1548303868367.jpg&a=w%3D195%26h%3D156%26fm%3Dwebp%26q%3D75&cd=ad771aff65b5e10230ef26812c4ecf3f 195w,/_gatsby/image/f7f9c33f7c0ae16b8717415eac5cb419/df0c2b24022ad8e375286b27b54ae0be/oracle-e1548303868367.webp?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2018%2F06%2Foracle-e1548303868367.jpg&a=w%3D390%26h%3D312%26fm%3Dwebp%26q%3D75&cd=ad771aff65b5e10230ef26812c4ecf3f 390w","type":"image/webp","sizes":"(min-width: 390px) 390px, 100vw"}],"fallback":{"src":"/_gatsby/image/f7f9c33f7c0ae16b8717415eac5cb419/a1ffaef3033161cc607ca9a88bde7cfb/oracle-e1548303868367.jpg?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2018%2F06%2Foracle-e1548303868367.jpg&a=w%3D98%26h%3D78%26fm%3Djpg%26q%3D75&cd=ad771aff65b5e10230ef26812c4ecf3f","srcSet":"/_gatsby/image/f7f9c33f7c0ae16b8717415eac5cb419/a1ffaef3033161cc607ca9a88bde7cfb/oracle-e1548303868367.jpg?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2018%2F06%2Foracle-e1548303868367.jpg&a=w%3D98%26h%3D78%26fm%3Djpg%26q%3D75&cd=ad771aff65b5e10230ef26812c4ecf3f 98w,/_gatsby/image/f7f9c33f7c0ae16b8717415eac5cb419/6253f1b67ced741a7f63bcf2528d0ee9/oracle-e1548303868367.jpg?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2018%2F06%2Foracle-e1548303868367.jpg&a=w%3D195%26h%3D156%26fm%3Djpg%26q%3D75&cd=ad771aff65b5e10230ef26812c4ecf3f 195w,/_gatsby/image/f7f9c33f7c0ae16b8717415eac5cb419/18b2d0e1952d643ea5c5f6a6458728ee/oracle-e1548303868367.jpg?u=http%3A%2F%2Flocalhost%2Fwp-content%2Fuploads%2F2018%2F06%2Foracle-e1548303868367.jpg&a=w%3D390%26h%3D312%26fm%3Djpg%26q%3D75&cd=ad771aff65b5e10230ef26812c4ecf3f 390w","sizes":"(min-width: 390px) 390px, 100vw"}},"layout":"constrained","width":390,"height":312,"backgroundColor":"rgb(120,136,152)"}}}},"wpPrevious":{"title":"Office365の自動保存をデフォルトでオフにする【Tips】","slug":"not-auto-save-office365"},"wpNext":{"title":"環境変数を変更したらWindowsサービスに気をつけろ","slug":"environment-variable-of-windows-service"}},"pageContext":{"id":"cG9zdDo3MTI=","previousPostId":"cG9zdDo4MzQ=","nextPostId":"cG9zdDo2MDE=","imagePath":null}},"staticQueryHashes":[],"slicesMap":{}}